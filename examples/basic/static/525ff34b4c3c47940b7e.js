"use strict";(self.webpackChunkcloud_onchain_trade_sdk=self.webpackChunkcloud_onchain_trade_sdk||[]).push([[498],{72316:(e,t,r)=>{r.d(t,{n:()=>l});var n,o,a,s=r(28730),i=r(63469),c=r(59849);function l(){return(0,s.v9)((function(e){return e.setting.color})),i.Pe,[c.i,c.C]}e=r.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e),("undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e})(l,"useSelector{color}",(function(){return[s.v9]})),(o="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&o.register(l,"useThemeScheme","/Users/user/Documents/work/x-mono-benchmark/apps/cloud-onchain-trade-sdk/src/hooks/useKlineTheme.js"),(a="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&a(e)},37374:(e,t,r)=>{r.d(t,{Z:()=>l});var n,o=r(87866),a=r(24799),s=r.n(a);e=r.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var i={getUserInfo:function(){return(0,o.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})))()},getUserSettings:function(){return(0,o.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})))()},getSessionInfo:function(){return(0,o.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})))()},updateUserInfo:function(){return(0,o.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})))()},onUserInfoChange:function(){return(0,o.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})))()},updateUserSettings:function(){},onUserSettingsChange:function(){},onLogin:function(){},onLogout:function(){},login:function(){},register:function(){},onRefresh:function(){},registerActionHandle:function(){return function(){}},constants:{},onAppEvent:function(){},storage:{setItem:function(){return Promise.resolve()},getItem:function(){return Promise.resolve()},removeItem:function(){return Promise.resolve()},onStorageEvent:function(e){}}},c=i;const l=c;var u,d;(u="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(u.register(i,"service","/Users/user/Documents/work/x-mono-benchmark/apps/cloud-onchain-trade-sdk/src/utils/electron.js"),u.register(c,"default","/Users/user/Documents/work/x-mono-benchmark/apps/cloud-onchain-trade-sdk/src/utils/electron.js")),(d="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&d(e)},52425:(e,t,r)=>{r.d(t,{D:()=>o});var n=r(52983);function o(e){const t=(0,n.useRef)(e);t.current=e;const r=(0,n.useCallback)(((...e)=>("function"==typeof t.current?t.current:()=>{})(...e)),[]);return"function"==typeof e?r:e}},89663:(e,t,r)=>{r.d(t,{XR:()=>l,fd:()=>i,rv:()=>a,uf:()=>s,yd:()=>c});var n=r(17921),o=r(12351);const a=r.n(o)()(((e,t)=>new RegExp(`\\d(?=(\\d{${t||3}})+${e>0?"\\.":"$"})`,"g")),((...e)=>e.join(","))),s=(e=0,t,r=3)=>{e="number"==typeof e?e:+e;const n=a(t,r);return e.toFixed(Math.max(0,~~t)).replace(n,"$&,")};function i(e,t=8){return new n.Z(e).decimalPlaces(t).toString()}function c(e,t,r=1){return new n.Z(e).toFixed(t,r)}function l(e,t=2){if(Math.abs(e)<1e-9&&Math.abs(e)>0)return`${e.toExponential(2)}`;if(Math.abs(e)<1e3)return function(e,t,r=!1){if(isNaN(e))return"NaN";if(void 0===t)return e;if(t<=0)return`${Math.floor(e)}`;if(r){const[r,n=""]=`${e}`.split(".");return`${r}.${n.slice(0,t).padEnd(t,"0")}`}return Number(e).toFixed(t)}(e,t);const r=[{value:1,symbol:""},{value:1e3,symbol:"K"},{value:1e6,symbol:"M"},{value:1e9,symbol:"B"},{value:1e12,symbol:"T"},{value:1e15,symbol:"P"},{value:1e18,symbol:"E"}];let n;for(n=r.length-1;n>0&&!(Math.abs(e)>=r[n].value);n--);return(e/r[n].value).toFixed(t).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")+r[n].symbol}},62910:(e,t,r)=>{r.d(t,{$:()=>s});var n=r(52983),o=r(27618);const a=({delay:e,color:t})=>n.createElement("div",{className:"h-full w-[3px] animate-spinner",style:{animationDelay:e,backgroundColor:t}}),s=(0,n.forwardRef)((({color:e="rgb(var(--colors-interactive-primary))",className:t,...r},s)=>{const i=Array(4).fill(1).map(((e,t)=>`-${t/10}s`)).reverse();return n.createElement("div",{className:(0,o.cn)("spinner flex w-[30px] h-[30px] items-center justify-between",t),ref:s,...r},i.map(((t,r)=>n.createElement(a,{key:r,delay:t,color:e}))))}));s.displayName="Spinner"},10498:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Gt});var n=r(97458),o=r(52983);const a=o.createContext({});var s=r(11273),i=r(73656);const c="chart_futures",l={"1s":"1S","1m":"1","3m":"3","5m":"5","15m":"15","30m":"30","1h":"60","2h":"120","4h":"240","6h":"360","8h":"480","12h":"720","1d":"1D","3d":"3D","1w":"1W","1M":"1M"},u=["dont_show_boolean_study_arguments","hide_last_na_study_output","left_toolbar","save_chart_properties_to_local_storage","compare_symbol","snapshot_trading_drawings"],d=["header_widget","header_symbol_search","symbol_info","header_compare","header_chart_type","display_market_status","symbol_search_hot_key","border_around_the_chart","remove_library_container_border","symbol_info","header_interval_dialog_button","show_interval_dialog_on_key_press","volume_force_overlay","header_resolutions","legend_context_menu"];var m;!function(e){e[e.Bars=0]="Bars",e[e.Candles=1]="Candles",e[e.Line=2]="Line",e[e.Area=3]="Area",e[e.Renko=4]="Renko",e[e.Kagi=5]="Kagi",e[e.PointAndFigure=6]="PointAndFigure",e[e.LineBreak=7]="LineBreak",e[e.HeikenAshi=8]="HeikenAshi",e[e.HollowCandles=9]="HollowCandles",e[e.Baseline=10]="Baseline",e[e.HiLo=12]="HiLo",e[e.Column=13]="Column",e[e.LineWithMarkers=14]="LineWithMarkers",e[e.Stepline=15]="Stepline",e[e.HLCArea=16]="HLCArea"}(m||(m={}));const p=({resetErrorBoundary:e,mainText:t,btnText:r})=>o.createElement("div",{className:"flex w-full h-full flex-col items-center justify-center"},o.createElement("div",{className:"text-xl text-t-primary"},t),o.createElement("div",{className:"text-sm underline cursor-pointer text-t-yellow mt-3",onClick:e},r));var h=r(77179),y=r.n(h),f=r(62910);const g=()=>o.createElement("div",{className:"absolute top-0 left-0 w-full h-full flex justify-center items-center z-[100]"},o.createElement(f.$,{className:"z-[100]"}));var b=r(6056),v=r(30062),S=r(82671);const C=["--colors-interactive-primary","--colors-background-bg1","--colors-interactive-primaryHover","--colors-t-primary","--colors-interactive-primaryActive","--colors-interactive-interactiveBg","--colors-interactive-interactiveBgHover","--colors-interactive-interactiveBgSelected"],w=e=>{const t=window.getComputedStyle(document.documentElement);C.forEach((r=>{e?.setCSSCustomProperty?.(r,t.getPropertyValue(r))}))},T=({widget:e,seriesStyle:t})=>{e.applyOverrides({"mainSeriesProperties.style":t})},_=(e,t)=>{const[r]=/(#\w+)/g.exec(e)||[];return r?((e,t)=>{const r=e.replace("#","");return`rgba(${parseInt(r.substring(0,2),16)},${parseInt(r.substring(2,4),16)},${parseInt(r.substring(4,6),16)},${t})`})(r,t):e},k=async({widget:e,theme:t,styles:r,onSave:n=(()=>null),onSetThemeDone:o})=>(await(({widget:e,theme:t})=>{const r=e.chart().getCheckableActionState("showCountdown");return e.changeTheme(t,{disableUndo:!0}),r?new Promise((t=>{setTimeout((()=>{e.chart().executeActionById("showCountdown"),t()}),0)})):Promise.resolve()})({widget:e,theme:t}),new Promise((t=>{setTimeout((()=>{e.applyOverrides(r.overrides),(({widget:e,styles:t})=>{try{const r=e.activeChart().getAllStudies().find((e=>"volume"===e?.name?.toLowerCase()));r&&e.activeChart().getStudyById(r.id).applyOverrides({"volume.color.0":_(t.overrides["candleStyle.downColor"],.5),"volume.color.1":_(t.overrides["candleStyle.upColor"],.5)})}catch(e){}})({widget:e,styles:r}),e.save(n),o?.(),t()}),0)}))),E=({symbol:e,symbolsInfo:t={},interval:r,theme:n,styles:a,limitOrders:s=[],positionOrders:i=[],executionOrders:c=[],seriesStyle:l,showIndicators:m,isChartReady:p,overwritingThemeOnLoaded:h=!1,widget:f,initialConfig:{tvConfig:g,onSave:C,onCreateOrderShapesError:_,onLoadConfig:E=(()=>Promise.resolve(null)),onLoading:I,onWidgetInitialized:x,onChartReadyDone:P,onChartReadyError:R,onWillUnmount:D,onWidgetRefNotFoundError:L,onScriptLoaded:M,onScriptLoadingError:B,onFirstTimeSetThemeDone:A,onSetThemeDone:$,onFirstTimeDataLoadedDone:H,onDataLoadedDone:V,onTradingViewInitError:N,onVisibleRangeChanged:z,onSymbolWillChange:O,onSymbolChanged:G,onIntervalChanged:U,onInitStudies:W}})=>{const[F,Z]=(0,o.useState)(0),j=(0,o.useCallback)((()=>Z((e=>e+1))),[Z]),Q=(0,o.useRef)([]),K=(0,o.useRef)([]),q=(0,o.useRef)([]),Y=(0,o.useRef)(),J=(0,o.useRef)(e),X=(0,o.useRef)(t),ee=(0,o.useRef)(n),te=(0,o.useRef)(a),re=(0,o.useRef)(h),ne=g.container_id;(0,o.useEffect)((()=>{ee.current=n}),[n]),(0,o.useEffect)((()=>{te.current=a}),[a]),(0,o.useEffect)((()=>{re.current=h}),[h]),(0,o.useEffect)((()=>{J.current=e}),[e]),(0,o.useEffect)((()=>{X.current=t}),[t]);const oe=(0,o.useCallback)((()=>{Y.current&&(({widget:e,onSave:t=(()=>Promise.resolve())})=>{e.save(t)})({widget:Y.current,onSave:C})}),[C]),ae=(0,o.useCallback)((e=>{if(!Y.current||!e)return;const t=Y.current.activeChart().getStudyById(e),r=J.current,n=X.current[r],{tickSize:o=1e7}=n||{},a=Math.log10(o);t?.applyOverrides({precision:a})}),[]),se=(0,o.useCallback)((()=>{Y.current&&Y.current.activeChart().getAllStudies().filter((({name:e})=>"Volume"!==e)).forEach((({id:e})=>ae(e)))}),[ae]),ie=(0,o.useCallback)((()=>{setTimeout((()=>{if(!Y.current)return;const e=Y.current.activeChart().getAllStudies();ae(e[0]?.id),oe()}),0)}),[ae,oe]),ce=(0,o.useCallback)((()=>{I?.(!0),G?.(),se()}),[se,I,G]),le=(0,o.useCallback)((e=>{I?.(!0),U?.(e)}),[U,I]),ue=(0,o.useCallback)((()=>{I?.(!1),j(),H?.(),se()}),[se,j,H,I]),de=(0,o.useCallback)((()=>{I?.(!1),j(),V?.()}),[j,V,I]),me=(0,o.useCallback)((({from:e,to:t})=>{z?.({startTime:1e3*e,endTime:1e3*t})}),[z]),pe=(0,o.useCallback)((async()=>{M?.();const e=await E(),t=(({tradingViewSave:e,styles:t},{symbol:r,interval:n,theme:o="Dark",library_path:a,custom_css_url:s="./themed.css",locale:i="en",overrides:c,debug:l=!1,time_frames:m=[],autosize:p=!0,toolbar_bg:h="transparent",studies_overrides:f,loading_screen:g,enabled_features:b=u,disabled_features:v=d,...S})=>{let C="Asia/Shanghai";try{C=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}const w=y()(e);if(w)for(let e=0;e<w.charts[0].panes.length;e++)w.charts[0].panes[e].sources[0].state.symbol=r,w.charts[0].panes[e].sources[0].state.interval=n;return{...S,symbol:r,interval:n,timezone:C,theme:o,library_path:a,custom_css_url:s,locale:i,overrides:c,debug:l,time_frames:m,autosize:p,toolbar_bg:h,studies_overrides:f,loading_screen:g||{backgroundColor:t.overrides["paneProperties.background"]},enabled_features:b,disabled_features:v,saved_data:w||void 0}})({tradingViewSave:e,styles:a},g);try{Y.current=new window.TradingView.widget(t),x?.(),Y.current?.onChartReady((async()=>{if(!Y.current)return L?.();try{w(Y.current),Y.current.subscribe("onAutoSaveNeeded",oe),Y.current.subscribe("study",ie),Y.current.chart().onDataLoaded().subscribe(null,ue,!0),Y.current.chart().onDataLoaded().subscribe(null,de),Y.current.chart().onSymbolChanged().subscribe(null,ce),Y.current.chart().onIntervalChanged().subscribe(null,le),Y.current.chart().onVisibleRangeChanged().subscribe(null,me),await(async({tradingViewSave:e,theme:t,styles:r,seriesStyle:n,widget:o,onInitStudies:a})=>{await(async({tradingViewSave:e,widget:t,theme:r,styles:n})=>{if(e)return Promise.resolve();await k({widget:t,theme:r,styles:n})})({widget:o,tradingViewSave:e,theme:t,styles:r}),a?.({tradingViewSave:e,widget:o}),T({widget:o,seriesStyle:n})})({tradingViewSave:e,theme:n,styles:a,seriesStyle:l,widget:Y.current,onInitStudies:W}),re.current&&await k({widget:Y.current,theme:ee.current,styles:te.current,onSave:C,onSetThemeDone:A}),setTimeout(se,0),P?.()}catch(e){R?.(e)}}))}catch(e){N?.(e)}}),[]),he=(0,b.G)(`${g.library_path}charting_library.js?v=1`,{removeOnUnmount:!1});return(0,o.useEffect)((()=>{"ready"!==he?"error"===he&&B?.(new Error("Cannot loading trading view")):pe()}),[pe,B,he]),(0,v.Z)((()=>{Y.current&&(Y.current?.remove(),Y.current=void 0,D?.())})),(0,S.Z)((()=>{if(0!==F&&Y.current)try{Q.current?.forEach((e=>e.remove())),Q.current=(({widget:e,shapes:t,styles:r})=>t.map((t=>(({widget:e,order:{id:t,text:r,price:n,quantity:o,isBuy:a,tooltip:s="",modifyTooltip:i="",cancelTooltip:c="",editable:l,onMove:u,onModify:d,onCancel:m},styles:p})=>{const h=a?p.originalTheme?.colors?.buy:p.originalTheme?.colors?.sell,y=e.chart().createOrderLine({}).setText(r).setPrice(n).setQuantity(o).setTooltip(s).setModifyTooltip(i).setCancelTooltip(c).setEditable(l).setExtendLeft(!1).setLineLength(65).setLineStyle(2).setLineColor(h).setBodyFont("normal 14pt Verdana").setQuantityFont("normal 14pt Verdana").setBodyBorderColor(h).setBodyBackgroundColor(h).setBodyTextColor(p.originalTheme?.colors?.t?.primary).setQuantityBorderColor(p.originalTheme?.colors?.line).setQuantityBackgroundColor(p.originalTheme?.colors?.popupBg).setQuantityTextColor(p.originalTheme?.colors?.t?.secondary).setCancelButtonBorderColor(p.originalTheme?.colors?.line).setCancelButtonBackgroundColor(p.originalTheme?.colors?.popupBg).setCancelButtonIconColor(p.originalTheme?.colors?.t?.secondary);return y.onModify((()=>d({id:t,text:y.getText(),price:y.getPrice(),quantity:y.getQuantity()}))).onMove((()=>u({id:t,text:y.getText(),price:y.getPrice(),quantity:y.getQuantity()}))).onCancel((()=>m({id:t,text:y.getText(),price:y.getPrice(),quantity:y.getQuantity()}))),y})({widget:e,order:t,styles:r}))))({widget:Y.current,styles:a,shapes:s})}catch(e){_?.(e)}}),[F,s,a]),(0,S.Z)((()=>{if(0!==F&&Y.current)try{K.current?.forEach((e=>e.remove())),K.current=(({widget:e,shapes:t,styles:r})=>t.map((t=>(({widget:e,position:{text:t,price:r,PNL:n,quantity:o,tooltip:a},styles:s})=>{const i=+o>0?s.originalTheme?.colors?.buy:s.originalTheme?.colors?.sell,c=n>0?s.originalTheme?.colors?.buy:n<0?s.originalTheme?.colors?.sell:i;return e.chart().createPositionLine({}).setText(t).setPrice(r).setQuantity(o).setTooltip(a).setExtendLeft(!1).setLineLength(100).setLineStyle(2).setLineColor(c).setBodyFont("normal 14pt Verdana").setQuantityFont("normal 14pt Verdana").setBodyBorderColor(c).setBodyBackgroundColor(c).setBodyTextColor(s.originalTheme?.colors?.t?.primary).setQuantityBorderColor(i).setQuantityBackgroundColor(s.originalTheme?.colors?.popupBg).setQuantityTextColor(s.originalTheme?.colors?.t?.primary)})({widget:e,position:t,styles:r}))))({widget:Y.current,styles:a,shapes:i})}catch(e){_?.(e)}}),[F,i,a]),(0,S.Z)((()=>{if(0!==F&&Y.current)try{q.current?.forEach((e=>e.remove())),q.current=(({widget:e,shapes:t,styles:r})=>t.map((t=>(({widget:e,executionShape:{price:t,time:r,text:n,tooltip:o,isBuy:a},styles:s})=>{const i=a?s.originalTheme?.colors?.buy:s.originalTheme?.colors?.sell;return e.chart().createExecutionShape({}).setPrice(t).setTime(r).setDirection(a?"buy":"sell").setText(n).setTooltip(o).setArrowHeight(8).setArrowSpacing(1).setArrowColor(i).setTextColor(s.originalTheme?.colors?.t?.primary).setFont("normal 14pt Verdana")})({widget:e,executionShape:t,styles:r}))))({widget:Y.current,styles:a,shapes:c})}catch(e){_?.(e)}}),[F,c,a]),(0,S.Z)((()=>{p&&Y.current&&T({widget:Y.current,seriesStyle:l})}),[l]),(0,S.Z)((()=>{p&&Y.current&&O?.(e)}),[p,O,e]),(0,S.Z)((()=>{p&&Y.current&&(({widget:e,symbol:t,interval:r,onDone:n=(()=>null)})=>{e.setSymbol(t,r,(()=>{e.activeChart().symbol()!==t?e.setSymbol(t,r,n):n()}))})({widget:Y.current,symbol:e,interval:r})}),[e,r]),(0,o.useEffect)((()=>{p&&Y.current&&(w(Y.current),k({widget:Y.current,theme:n,styles:a,onSetThemeDone:$,onSave:C}))}),[ne,p,n,a,C,$]),(0,S.Z)((()=>{p&&Y.current&&(e=>{e.chart().executeActionById("insertIndicator")})(Y.current)}),[m]),(0,o.useImperativeHandle)(f,(()=>Y.current)),o.createElement("div",{id:g.container_id,className:"h-full"})},I=e=>{const[t,r]=(0,o.useState)(!1),n=(0,o.useMemo)((()=>y()(e.initialConfig)),[]),a=(0,o.useCallback)((()=>{r(!0),n.onChartReadyDone?.()}),[n]),s=(0,o.useMemo)((()=>({...e,isChartReady:t,initialConfig:{...n,onChartReadyDone:a}})),[n,t,a,e]);return o.createElement("div",{className:"h-full relative"},o.createElement(E,{...s}),!t&&o.createElement("div",{className:"h-full w-full absolute left-0 top-0",style:{background:e.styles.overrides["paneProperties.background"]}},o.createElement(g,null)))};var x=r(4231),P=r(79542),R=r(6921),D=r(59712);const L=({error:e,resetErrorBoundary:t})=>{const r=(0,o.useCallback)((e=>{e.preventDefault(),t()}),[t]);return o.createElement(x.bZ,{variant:"destructive"},o.createElement(x.Cd,{className:"mb-2 leading-5"},"Sorry, There is an error happening. Please refresh the page."," ",o.createElement("button",{type:"button",onClick:r,className:"text-t-link hover:text-t-linkHover"},"Reset Here")),o.createElement(x.X,{className:"text-body2 flex flex-col gap-2"},o.createElement("p",null,"If this keep happening please contract our support for help."),o.createElement("p",null,"Error Details:"),o.createElement("pre",{className:"text-caption2 text-t-third break-all"},e.message)))},M=e=>{const t=(0,o.useCallback)(((e,t)=>{D.log(t.componentStack),P.Tb(e)}),[]);return o.createElement(R.SV,{FallbackComponent:L,onError:t,...e})};M.displayName="ErrorBoundary";const B=M;var A=r(5571),$=r(9704),H=r(93112),V=r(87608),N=r.n(V),z=r(83680),O=r.n(z),G=r(39378),U=r(78659),W=r(59712),F=r(59712);const Z=e=>{switch(e){case"index":return"ipTradingView";case"mark":return"mpTradingView";default:return"myTradingView"}},j=async(e,t)=>{[c].map((e=>O().createInstance({name:e}))).forEach((r=>r.setItem(t,e)))},Q=({symbol:e,namespace:t,hidden:r,datafeed:n,storage:s,hideToolbarDefault:c=!1})=>{const{chartRef:d,useTheme:h,useLng:y,trackGAEvent:f,getI18n:g,logOnChartReady:b,logOnChartResponsive:v,useIntervalStore:S,useChartTypeStore:C,useTvChartStyleStore:w,useIfShowTVIndicatorsMenu:T,usePriceTypeStore:_,useLoadingStore:k,TRADINGVIEW_STATIC_PATH:E,usePositionLine:x,useOrderLine:P}=(0,o.useContext)(a),R=(0,o.useRef)(),{theme:D}=h(),L=(0,o.useRef)(-1),[M,B]=(0,o.useState)(!1),{positionLines:V}=x({symbol:e,namespace:t}),{orderLines:z}=P({symbol:e,namespace:t}),[O,Q]=S(),[K]=_(),[,q]=k(),Y=T(),[J]=w(),[X]=C(),ee=X===$.oX.Line?m.Line:J,te=l[O],re=Z(K),ne=(({chartRef:e,interval:t,onReadyCallback:r})=>{const n=(0,o.useRef)(!1),{tradingMode:a}=(0,U.C)(),s=(0,o.useCallback)((()=>{try{"dumb"===a&&e.current?e.current?.chart().setResolution("1S",(()=>!0)):e.current?.chart().setResolution("5",(()=>!0))}catch(e){W.warn("try to set resolution failed",e)}}),[a,e]),i=(0,o.useCallback)((()=>{try{"dumb"!==a&&e.current?e.current?.chart().setChartType(1):e.current?.chart().setChartType(2)}catch(e){W.warn("try to set chart type failed",e)}}),[a,e]);return(0,o.useEffect)((()=>{"1S"===t&&n.current&&e.current?.chart().setChartType(2)}),[t,e]),(0,o.useEffect)((()=>{n.current&&(s(),i())}),[s,i]),(0,o.useCallback)((()=>{n.current=!0,s(),i(),r?.()}),[r,s,i])})({onReadyCallback:b,chartRef:R,interval:te});d&&(d.current=R.current);const oe=(0,o.useCallback)((()=>{try{R.current?.chart().refreshMarks()}catch(e){F.warn("try to refreshMarks error")}}),[]);(0,A.x)({onBlockNumber(e){F.debug("new block",e,"try to refresh markers"),oe()}});const ae=(0,o.useMemo)((()=>`${t}-tradingview_${re}_${D}`),[t,re,D]),se=(ie=y(),i.electron?function(e){return{cn:"zh",kr:"ko",tw:"zh_TW",vn:"vi",tr:"tr",ru:"ru",es:"es",ro:"ro",cs:"cs",fr:"fr",de:"de",pt:"pt",it:"it",pl:"pl",nl:"nl_NL",id:"id",ja:"ja"}[e]||"en"}(ie):function(e){switch(e){case"zh-CN":return"zh";case"zh-HK":case"zh-TW":return"zh_TW";case"ja":return"ja";case"ko":return"ko";case"th":return"th";case"he":return"he_IL";case"ru":return"ru";case"cs":return"cs";case"sv":return"sv";case"vi":return"vi";case"tr":return"tr";case"ro":return"ro";case"pt-PT":case"pt-BR":case"pt":return"pt";case"pl":return"pl";case"nl":return"nl_NL";case"it":return"it";case"fr":return"fr";case"es":case"es-LA":return"es";case"de":return"de";case"id":return"id_ID";default:return"en"}}(ie));var ie;const ce=(0,o.useMemo)((()=>{const e=e=>e.startsWith("#")?e:`#${Array.from(e.matchAll(/(\d{1,3})/g)).map((([e])=>{const t=Number(e).toString(16);return 1===t.length?`0${t}`:t})).join("")}`,t=window.getComputedStyle(document.documentElement),r=e(t.getPropertyValue("--colors-interactive-buy")),n=e(t.getPropertyValue("--colors-interactive-sell")),o=e(t.getPropertyValue("--colors-background-bg1")),a=e(t.getPropertyValue("--colors-border-lineSubtle"));return{overrides:{volumePaneSize:"medium","symbolWatermarkProperties.transparency":85,"symbolWatermarkProperties.color":"rgba(0, 0, 0, 0)","scalesProperties.textColor":e(t.getPropertyValue("--colors-t-third")),"scalesProperties.lineColor":e(t.getPropertyValue("--colors-border-line")),"scalesProperties.backgroundColor":o,"paneProperties.backgroundType":"solid","paneProperties.background":o,"paneProperties.legendProperties.showSeriesTitle":!1,"paneProperties.horzGridProperties.color":a,"paneProperties.vertGridProperties.color":a,"paneProperties.crossHairProperties.color":e(t.getPropertyValue("--colors-t-third")),"candleStyle.upColor":r,"candleStyle.downColor":n,"candleStyle.drawWick":!0,"candleStyle.drawBorder":!0,"candleStyle.borderColor":"transparent","candleStyle.borderUpColor":r,"candleStyle.borderDownColor":n,"hollowCandleStyle.upColor":r,"hollowCandleStyle.downColor":n,"hollowCandleStyle.drawWick":!0,"hollowCandleStyle.drawBorder":!0,"hollowCandleStyle.borderColor":"transparent","hollowCandleStyle.borderUpColor":r,"hollowCandleStyle.borderDownColor":n,"hollowCandleStyle.wickUpColor":r,"hollowCandleStyle.wickDownColor":n,"haStyle.upColor":r,"haStyle.downColor":n,"haStyle.drawWick":!0,"haStyle.drawBorder":!0,"haStyle.borderColor":"transparent","haStyle.borderUpColor":r,"haStyle.borderDownColor":n,"haStyle.wickUpColor":r,"haStyle.wickDownColor":n,"barStyle.upColor":r,"barStyle.downColor":n,"areaStyle.color1":r,"areaStyle.color2":n,"areaStyle.linecolor":n,"baselineStyle.baselineColor":r,"baselineStyle.topFillColor1":r,"baselineStyle.topFillColor2":n,"baselineStyle.bottomFillColor1":r,"baselineStyle.bottomFillColor2":n,"baselineStyle.topLineColor":r,"baselineStyle.bottomLineColor":n}}}),[D]),le=(0,o.useMemo)((()=>g("trd-chart-tv-load-timeout",{defaultValue:"Failed to load TradingView due to network issues."})||""),[g]),ue=(0,o.useMemo)((()=>g("trd-chart-crash-reload",{defaultValue:"Reload"})||""),[g]),de=(0,o.useCallback)((()=>window.location.reload()),[]),me=(0,o.useCallback)((()=>{L.current=Date.now()}),[]),pe=(0,o.useCallback)((()=>s.getItem(re)),[s,re]),he=(0,o.useCallback)((e=>{Q((0,G.invert)(l)[e])}),[Q]),ye=(0,o.useCallback)((async e=>j(e,re)),[re]),fe=(0,H.D)((e=>q(e))),ge=(0,o.useCallback)((()=>n.setContainerId?.(ae)),[n,ae]),be=(0,o.useCallback)((async()=>{const e=await s.getItem(re);j(e,re),n.unsubscribe()}),[s,n,re]),ve=(0,o.useCallback)((e=>F.log(JSON.stringify({type:"tv-error",error:e}),"custom")),[]),Se=(0,o.useCallback)((()=>{f("trd_chart_tv_download_timeout",{user_network:JSON.stringify(navigator.connection)}),B(!0)}),[f]),Ce=(0,o.useCallback)((()=>v(L.current)),[v]),we=(0,o.useMemo)((()=>["create_volume_indicator_by_default","create_volume_indicator_by_default_once","header_symbol_search","header_compare","symbol_search_hot_key","border_around_the_chart","timezone_menu","go_to_date","main_series_scale_menu","timeframes_toolbar"]),[]),Te=E?`/${E}/charting_library_26/`:"charting_library_26/";return M?o.createElement(p,{mainText:le,btnText:ue,resetErrorBoundary:de}):o.createElement("div",{className:N()("h-full p-px [&_iframe]:rounded-lg",r?"hidden":"block")},o.createElement(I,{widget:R,symbol:e,interval:te,theme:D,styles:ce,limitOrders:z,positionOrders:V,showIndicators:Y,seriesStyle:ee,initialConfig:{tvConfig:{overrides:ce.overrides,container_id:ae,container:ae,backgroundColor:"rgba(255, 0, 0, 1)",library_path:Te,custom_css_url:"custom_css.css?v=0.02",symbol:e,interval:te,theme:D,locale:se,datafeed:n,disabled_features:we,enabled_features:[...u,c&&"hide_left_toolbar_by_default","seconds_resolution","hide_left_toolbar_by_default","iframe_loading_compatibility_mode"].filter(Boolean),favorites:{intervals:["1S","1","5","15","60","240","1D"],chartTypes:["Candles","Line"]}},onIntervalChanged:he,onScriptLoaded:me,onLoadConfig:pe,onSave:ye,onLoading:fe,onWidgetInitialized:ge,onChartReadyDone:ne,onWillUnmount:be,onCreateOrderShapesError:ve,onScriptLoadingError:Se,onFirstTimeDataLoadedDone:Ce}}))},K=e=>{const{getI18n:t,usePriceTypeStore:r}=(0,o.useContext)(a),[n]=r(),s=Z(n),i=(0,o.useMemo)((()=>t("trd-chart-crash-info",{defaultValue:"Something is wrong with the chart."})||""),[t]),c=(0,o.useMemo)((()=>t("trd-chart-crash-refresh",{defaultValue:"Refresh"})||""),[t]),l=(0,o.useCallback)((()=>e.storage.removeItem(s)),[e.storage,s]),u=(0,o.useCallback)(((e,t)=>{F.log(JSON.stringify({type:"trading_view",error:e,componentStack:t}),"custom")}),[]);return o.createElement(B,{name:"trading_view",FallbackComponent:({resetErrorBoundary:e})=>o.createElement(p,{mainText:i,btnText:c,resetErrorBoundary:e}),onReset:l,onError:u},o.createElement(Q,{...e}))},q=({symbol:e,namespace:t})=>{const{chartRef:r,storage:n,useIntervalStore:i,useCreateDatafeed:c,useAllProduct:l}=(0,o.useContext)(a),{isMobile:u}=(0,s.F)(),[d,m]=(0,o.useState)(1),p=(0,o.useRef)(!0),[h,y]=(0,o.useState)(0),[f,g]=(0,o.useState)(!1),[b]=i(),v=l()[e],{pair:S="",tickSize:C=""}=v||{};(0,o.useEffect)((()=>{const e=()=>{y(Date.now()),m((e=>-1*e))};return window.addEventListener("online",e),()=>{window.removeEventListener("online",e)}}),[]),(0,o.useEffect)((()=>{p.current=!1,f&&g(!1)}),[]);const w=c({symbol:e,namespace:t,chartRef:r,contractType:"PERPETUAL",reconnectTVTimes:h,TICK_SIZE:.01,reloadTV:m});return e&&b&&S?o.createElement(K,{key:`tv-${d}`,chartRef:r,symbol:e,storage:n,namespace:t,datafeed:w,tickSize:C,hidden:!1,hideToolbarDefault:u}):null};function Y(){const{symbol:e,namespace:t}=(0,o.useContext)(a);return o.createElement(q,{symbol:e,namespace:t})}const J=e=>{const t=(0,o.useRef)();return(0,o.useMemo)((()=>o.createElement(a.Provider,{value:{chartRef:t,getI18n:e.getI18n,useLng:e.useLng,symbol:e.symbol,namespace:e.namespace,storage:e.storage,STATIC_HOST:e.STATIC_HOST,TRADINGVIEW_STATIC_PATH:e.TRADINGVIEW_STATIC_PATH,showLoading:e.showLoading,electron:e.electron,useThemeScheme:e.useThemeScheme,trackGAEvent:e.trackGAEvent,logOnChartReady:e.logOnChartReady,logOnChartResponsive:e.logOnChartResponsive,useOrderLine:e.useOrderLine,usePositionLine:e.usePositionLine,useTheme:e.useTheme,useAllProduct:e.useAllProduct,useLoadingStore:e.useLoadingStore,useTvChartStyleStore:e.useTvChartStyleStore,useIfShowTVIndicatorsMenu:e.useIfShowTVIndicatorsMenu,useIntervalConfigStore:e.useIntervalConfigStore,useIntervalStore:e.useIntervalStore,useSelectedIntervalsStore:e.useSelectedIntervalsStore,useIsEditingIntervalStore:e.useIsEditingIntervalStore,usePriceTypeStore:e.usePriceTypeStore,useChartTypeStore:e.useChartTypeStore,useCreateDatafeed:e.useCreateDatafeed}},o.createElement(Y,null))),[e])};var X=r(33687),ee=r(39671),te=r(16552);const re=e=>[e.interval,e.setInterval],ne=e=>[e.chartType,e.setChartType],oe=e=>[e.loading,e.setLoading],ae=e=>[e.selectedIntervals,e.setSelectedIntervals],se=e=>[e.tvChartStyle,e.setTvChartStyle],ie=e=>[e.isOpen,e.setIsOpen],ce=e=>[e.isEditing,e.setIsEditing],le=e=>[e.priceType,e.setPriceType],ue=e=>e.loading,de=e=>e.ifShowIndicatorsMenu,me=e=>e.toggleTVIndicatorsMenu;var pe=r(72316),he=r(34254),ye=r(52590),fe=r(37374),ge=r(43785),be=r(87354),ve=r(14369),Se=r(24722);const Ce=()=>{const{data:e}=(0,Se.S)(),{data:t}=(0,ve.R)(),{productMap:r}=(0,te.GS)(),n=(0,o.useMemo)((()=>(e||[]).map((e=>e.name.replace(/\//,"")))),[e]),a=(0,o.useMemo)((()=>t?.map((e=>e.name.replace(/\//,"")))??[]),[t]);return(0,o.useMemo)((()=>Object.keys(r).filter((e=>n.concat(a).flat()?.includes(e))).reduce(((e,t)=>(e[t]=r[t],e)),{})),[r,n,a])};var we=r(85125);const Te=e=>()=>(0,te.v5)(e)(oe),_e=e=>()=>(0,te.OL)(e)(se),ke=e=>()=>(0,te.BD)(e)(de),Ee=e=>()=>(0,te.BD)(e)(me),Ie=e=>()=>(0,te.WH)(e)(ie),xe=e=>()=>(0,te.Qy)(e)(re),Pe=e=>()=>(0,te.m2)(e)(ae),Re=e=>()=>(0,te.lR)(e)(ce),De=e=>()=>(0,te.kH)(e)(le),Le=e=>()=>(0,te.Nu)(e)(ne);var Me=r(51485),Be=r(41925);const Ae=()=>{};var $e;!function(e){e.DISORDER="DISORDER",e.TIMEOUT="TIMEOUT"}($e||($e={}));const He={plain:Symbol("plain"),allHead:Symbol("allHead"),allTail:Symbol("allTail"),raceHead:Symbol("raceHead"),raceTail:Symbol("raceTail")},Ve=Symbol("head"),Ne=(e,t,r)=>({type:r,done:!1,timeout:t,endTime:0,id:e,prev:void 0,next:void 0}),ze={},Oe={},Ge=({eventId:e,scheduleId:t="",stepId:r,timeStamp:n=Date.now(),...o})=>{Oe?.[e]?.[t]||(Oe[e]={},Oe[e][t]=[]),Oe[e][t].push({stepId:r,...o,timeStamp:n}),ze?.[e]?.[t]&&(Oe[e][t]=(0,G.sortBy)(Oe[e][t],(e=>e.timeStamp)),Oe[e][t].forEach((({stepId:r,timeStamp:n,...o})=>{ze[e][t][r]({...o,timeStamp:n,onEnd:()=>{delete ze[e][t]}})})),Oe[e][t]=[])};Ge.init=({scheduleId:e="",config:t={},eventId:r,step:n})=>{ze?.[r]||(ze[r]={}),ze[r][e]=(({step:e,eventId:t,config:r={}})=>{const n=[];let o=Object.create(null);const a=e=>{const o=n.slice(0,20).reverse(),a=(0,Be.v4)();if(o.length){const[n]=o;let s=n.status;for(let e=1;e<o.length;e++)s+=` <-${o[e-1].duration}- ${o[e].status}`;(0,ge.wu)(`ga_${t}`,{sessionId:a,duration:o[0].duration,statuses:s,status:n.status,...r,...e})}else(0,ge.wu)(`ga_${t}`,{sessionId:a,...r,...e})};let s=!1;const i=Ne((0,Be.v4)(),1,He.plain),c=new Map;c.set(Ve,i),e.getMap(c,i);const l=c.get(Ve)?.next,u=new Map([[l.id,l]]),d=[];c.forEach(((e,t)=>{"string"==typeof t&&d.push(t)}));const m=e=>{o=e},p=()=>{s=!0},h=d.reduce(((e,t)=>(e[t]=({log:e=(e=>{}),catch:r=(e=>{}),onEnd:i=Ae,timeStamp:c})=>{if(!s){if(u.has(t)){const s=u.get(t);if(c?s.endTime=c:s.prev&&!("size"in s.prev)?s.endTime=s.prev.endTime:s.endTime=Date.now(),u.delete(t),s.type===He.plain&&s.prev&&!("size"in s.prev)){const i=0===s.prev.endTime?0:s.endTime-s.prev.endTime;((e,t)=>{n.push({status:e,duration:t})})(t,i),i>1e3*s.timeout?r({error:$e.TIMEOUT,context:{...o,statusList:n},setContext:m,stop:p,trackGAEventParams:a}):e({context:{...o,statusList:n},setContext:m,stop:p,trackGAEventParams:a})}s.done=!0;const i=e=>{switch(e.type){case He.allHead:case He.raceHead:case He.raceTail:h[e.id]({});break;case He.allTail:if(e.prev&&"add"in e.prev){let t=0;e.prev.forEach((e=>{e.done&&t++})),t===e.prev.size&&h[e.id]({})}}};s.next&&("add"in s.next?s.next.forEach((e=>{u.set(e.id,e),i(e)})):(u.set(s.next.id,s.next),i(s.next)))}else r({error:$e.DISORDER,context:{...o,statusList:n},setContext:m,stop:p,trackGAEventParams:a}),s=!0;0===u.size&&i()}},e)),{});return h})({step:n,config:t,eventId:r})};const Ue=({id:e,timeout:t=1})=>{const r=[],n={_:e=>(r.push(e),n),getMap:(n,o)=>{const a=n.has(e)?n.get(e):Ne(e,t,He.plain);return o.next?"add"in o.next?o.next.add(a):o.next=new Set([o.next,a]):o.next=a,a.prev?"add"in a.prev?a.prev.add(o):a.prev=new Set([o,a.prev]):a.prev=o,n.has(e)?a:(n.set(e,a),o=a,r.forEach((e=>{o=e.getMap(n,o)})),o)}};return n};Ue.all=(...e)=>{const t=[],r={_:e=>(t.push(e),r),getMap:(r,n)=>{const o=Ne((0,Be.v4)(),1,He.allHead),a=Ne((0,Be.v4)(),1,He.allTail);return r.set(o.id,o),r.set(a.id,a),n.next?"add"in n.next?n.next.add(o):n.next=new Set([n.next,o]):n.next=o,o.prev=n,o.next=new Set,a.prev=new Set,e.forEach((e=>{const t=e.getMap(r,o);t.next=a,a.prev.add(t)})),n=a,t.forEach((e=>{n=e.getMap(r,n)})),n}};return r},Ue.race=(...e)=>{const t=[],r={_:e=>(t.push(e),r),getMap:(r,n)=>{const o=Ne((0,Be.v4)(),1,He.raceHead),a=Ne((0,Be.v4)(),1,He.raceTail);return r.set(o.id,o),r.set(a.id,a),n.next?"add"in n.next?n.next.add(o):n.next=new Set([n.next,o]):n.next=o,o.prev=n,o.next=new Set,a.prev=new Set,e.forEach((e=>{const t=e.getMap(r,o);t.next=a,a.prev.add(t)})),n=a,t.forEach((e=>{n=e.getMap(r,n)})),n}};return r};const We=e=>{const t=Math.floor(e/1e3);return t<=100?t:100*Math.floor(t/100)};var Fe=r(52425),Ze=r(58407),je=r(89215),Qe=r(75516),Ke=r(13804),qe=r(4401),Ye=r(91359);const Je=new Map;var Xe=r(89663),et=r(71796),tt=r(17921),rt=r(82452),nt=r(2547),ot=r(96988),at=r(9824),st=r.n(at),it=r(23773),ct=r.n(it),lt=r(15032),ut=r.n(lt),dt=r(90982),mt=r.n(dt),pt=r(64172),ht=r.n(pt),yt=r(43194),ft=r.n(yt),gt=r(54241),bt=r.n(gt),vt=r(46012),St=r.n(vt),Ct=r(41157),wt=r.n(Ct);st().extend(ct()),st().extend(ut()),st().extend(St()),st().extend(wt()),st().extend(ht()),st().extend(mt()),st().extend(ft()),st().extend(bt());const Tt=st();var _t=r(19910),kt=r(97655),Et=r(82521),It=r(76922);const xt=({symbol:e,chartRef:t})=>{const{dumb:r,dumbPositionSubgraph:n,dumbHistorySubgraph:o}=(0,nt.B)(),{tradingMode:a}=(0,U.C)(),{getI18n:s}=(0,ot.V6)(),i=(0,rt.q)();(0,It.X)({symbol:e,chartRef:t}),(0,Et.b)({symbol:e,chartRef:t});const c=(0,et.NL)();return(0,Fe.D)((async()=>{if("dumb"!==a||!r)return[];const[t,l]=[c.getQueryData([_t.a.DumbPositionList,e,n]),c.getQueryData([_t.a.DumbHistoryList,e,o])],u=window.getComputedStyle(document.documentElement).getPropertyValue("--colors-t-buy"),d=window.getComputedStyle(document.documentElement).getPropertyValue("--colors-t-sell"),m=window.getComputedStyle(document.documentElement).getPropertyValue("--colors-interactive-primary");return[...t&&t?.data?.length>0?t?.data?.map((e=>{return{id:e.positionHash,time:e.startTime,borderWidth:1,hoveredBorderWidth:2,color:{background:e.isLong?u:d,border:"#fff"},text:(t=e,`${t.isLong?s("chart-dumb-long","Long"):s("chart-dumb-short","Short")}\n${s("userinfo-positions-column-entryPrice","Entry Price")}:\t${(0,Xe.uf)(t.entryPrice,i[kt.a[t.tokenIn]??t.tokenIn]?.assetDecimal)}\n${s("chart-dumb-openTime","Open time")}:\t${Tt(1e3*t.startTime).format("mm:ss")}\n${s("chart-dumb-amount","Amount")}:\t${t.principal} ${kt.a[t.tokenIn]??t.tokenIn}`),label:e.isLong?"L":"S",labelFontColor:"#fff",minSize:25};var t})):[],...(l&&l?.pages?.length>0?l?.pages?.reduce(((e,t)=>[...e,...t.data]),[]):[]).map((e=>{const t=e.isLong?Number(e.executionPrice)>Number(e.entryPrice):Number(e.entryPrice)>Number(e.executionPrice),r=t?new tt.Z(e.pnl||0).minus(e.closeFee||0).div(e.principal||1):-1,n=t?new tt.Z(e.pnl||0).minus(e.closeFee||0):new tt.Z(e.principal||0).multipliedBy(r),o=(0,Xe.uf)(n,i[kt.a[e.tokenIn]??e.tokenIn]?.assetDecimal);return{id:e.positionHash,time:e.executionTime,borderWidth:1,hoveredBorderWidth:2,color:{background:m,border:"#fff"},text:(a=e,`${s("chart-dumb-expire","Expire")}${t?"🤑":"😈"}\n${s("userinfo-positions-column-entryPrice","Entry Price")}:\t${(0,Xe.uf)(a.entryPrice,i[kt.a[a.tokenIn]??a.tokenIn]?.assetDecimal)}\n${s("userinfo-positions-column-expirePrice","Expire Price")}:\t${(0,Xe.uf)(a.executionPrice,i[kt.a[a.tokenIn]??a.tokenIn]?.assetDecimal)}\n${s("chart-dumb-expireTime","Expire time")}:\t${Tt(1e3*a.executionTime).format("mm:ss")}\n${s("chart-dumb-pnl","PNL")}:\t${t?"+":""}${o} ${a.tokenIn}`),label:"E",labelFontColor:"#fff",minSize:25};var a}))]}))},Pt=new Ze.v;async function Rt(e,t){const r=Object.keys(t).map((e=>`${e}=${t[e]}`)).join("&"),n=await(0,Me.U2)(`${e}?${r}`);return n?.code?n.data:n}const Dt=({symbol:e,namespace:t,chartRef:r,contractType:n,reconnectTVTimes:a,TICK_SIZE:s,reloadTV:i})=>{const[c]=xe(t)(),l=Ce()[e],{pair:u="",tickSize:d=""}=l||{},m=(({pair:e,contractType:t,symbol:r,interval:n,reconnectTimes:a,chartRef:s})=>{const i=xt({symbol:r,chartRef:s}),c=(0,o.useRef)((0,Be.v4)()),l=(0,o.useRef)((()=>0)),u=(0,o.useRef)({klineDataQueue:[]}),d=(0,o.useRef)([]),m=(0,o.useRef)(),p=(0,o.useRef)(0),h=(0,o.useRef)((function(){})),f=((e,t)=>{const r="1s"===t,{uuid:n}=(0,te.QK)(),a=(0,o.useMemo)((()=>`i${e?.toUpperCase()}@kline_${r?"1m":t}`),[e,t,r]),{online:s}=(0,je.Z)(),{lastJsonMessage:i,sendJsonMessage:c,readyState:l}=(0,Ke.ZP)(`${X.brokerConfig.futuresWsHost}/stream`,{share:!0,filter:(0,Ye.eJ)(a),shouldReconnect:e=>1e3!==e.code},s),u=(0,o.useRef)(!1);(0,o.useEffect)((()=>{1===l&&!1===u.current&&(u.current=!0)}),[l]);const d=(0,Qe.Z)(l);(0,o.useEffect)((()=>{0===d&&1===l&&Je.size>0&&u.current&&Je.forEach(((e,t)=>{const r=n();c({method:"SUBSCRIBE",params:[t],id:r})}))}),[s,d,l,c,a,n]);const m=(0,o.useCallback)((()=>{const e=n();return Je.has(a)?Je.set(a,(Je.get(a)??0)+1):(c({method:"SUBSCRIBE",params:[a],id:e}),Je.set(a,1)),function(){const t=Je.get(a);t&&t>0&&Je.set(a,(Je.get(a)??0)-1),void 0!==t&&t<=1&&(c({method:"UNSUBSCRIBE",params:[a],id:e}),Je.delete(a))}}),[c,a,n]);return(0,o.useEffect)((()=>{const e=m();return()=>e()}),[m]),(0,o.useMemo)((()=>i?.data&&i?.stream===a?{condition:{symbol:e,interval:t},...(0,qe.Vs)(i?.data,{pair:"ps",contractType:"ct",eventTime:"E",symbol:"s",time:r?"E":(0,qe.cP)("k.t"),open:qe.zW.number("k.o"),close:qe.zW.number("k.c"),high:r?qe.zW.number("k.c"):qe.zW.number("k.h"),low:r?qe.zW.number("k.c"):qe.zW.number("k.l"),volume:qe.zW.number("k.v"),quantity:qe.zW.number("k.q")})}:void 0),[i?.data,i?.stream,a,r,e,t])})(r,n);m.current={klineData:f};const g=(0,o.useMemo)((()=>(0,G.throttle)((()=>{Pt.emit(c.current,"")}),1e3)),[]);(0,o.useEffect)((()=>{f&&g()}),[f,g]);const b=(0,Fe.D)((e=>{const t=e[e.length-1]?.time;t&&t>p.current&&(p.current=t)})),v=(0,Fe.D)((e=>{if(0===p.current)return;const t=1e3*(0,qe.$n)(n);e-p.current>=10*t&&h.current?.()})),S=(0,Fe.D)((e=>{h.current=e})),C=(0,Fe.D)((({interval:e,pair:t,contractType:o,bizDataReducers:a})=>function(t,s){let i=!1;const c="1s"===n;async function l({startTime:n=0,endTime:l=0},d=(()=>{}),m=(()=>{})){const p=1e3;let h=-1,y=!1,f=n;const g=[];for(;-1===h||h===p;)try{const n=-1===h?f:Number(f)+1,s=c?{startTime:`${n}`,endTime:`${l>Date.now()?Date.now():l}`,limit:p}:{interval:e,contractType:o,...0!==l&&{startTime:n,endTime:l,limit:p}};s.symbol=r;const i=await t(c?"/bapi/futures/v1/public/future/apx/V2MarkPriceKline":"/fapi/v1/markPriceKlines",s);if(!i||0===i.length)break;h=i.length,i.forEach((e=>{const[t,r,n,o,s,i="0",,l="0"]=e.map(Number),u=a.reduce(((e,t)=>t(e)),{time:c?1e3*t:t,open:r,high:n,low:o,close:s,volume:c?0:i,quantity:c?0:l,id:(0,Be.v4)()});g.push(u)})),f=g[g.length-1].time}catch(e){y=!0,m(e);break}y||i||(s(g),u.current.klineDataQueue=g.slice(-100),d({data:g,isLoadAll:0===g.length}))}return l.abort=()=>{i=!0},l})),w=(0,Fe.D)(((e,t)=>{const{uid:r,resolution:n}=e;return l.current=Pt.on(c.current,(()=>{const{klineData:e}=m.current||{},o=`${e?.condition.symbol}_#_${ee.nw[e?.condition.interval]}`;if(!e||r!==o)return;e.id=(0,Be.v4)(),(0,qe.SP)(u.current.klineDataQueue,y()(e));const a=d.current.reduce(((e,t)=>t(e)),e),{time:s}=a;v(s),s>p.current&&(p.current=s),"1S"===n&&(a.open=a.close,a.high=a.close,a.low=a.close),t&&t(a)})),l.current}));return(0,o.useMemo)((()=>({subscribe:w,unsubscribe:l.current,getData:C({interval:n,pair:e,contractType:t,bizDataReducers:d.current})(Rt,b),setDisconnectCallback:S,bizDataReducers:d.current,trackingData:u.current,getMarks:i})),[t,C,i,n,e,S,w,b,a,i])})({reconnectTimes:a,pair:u,contractType:n,symbol:e,interval:c,chartRef:r});(0,o.useEffect)((()=>{m.setDisconnectCallback((()=>i((e=>-1*e))))}),[i,m]);const p=(0,o.useMemo)((()=>((e,{tickSize:t,isFutures:r=!1})=>{const n=new Map;let o,a,s,i=t,c=e;const l=(0,G.once)((e=>Ge({eventId:"trd_chart_tv_load_timeout",stepId:"getBarsEnd",catch({error:t,trackGAEventParams:r}){r({GET_BAR_END_TYPE:t,duration_:We(e-s)})},log({trackGAEventParams:t}){t({GET_BAR_END_TYPE:"SUCCESS",duration_:We(e-s)})}}))),u=(0,G.once)((()=>Ge({eventId:"trd_chart_tv_load_timeout",stepId:"getBarsStart",catch({error:e,trackGAEventParams:t}){t({GET_BAR_START_TYPE:e})},log({trackGAEventParams:e}){e({GET_BAR_START_TYPE:"SUCCESS"})}})));return{getBars:async function(...e){let[t,r,n,a]=[0,0,(...e)=>{},e=>{}];"number"==typeof e[2]?(t=e[2],r=e[3],n=e[4],a=e[5]):(t=e[2].from,r=e[2].to,n=e[3],a=e[4]),s=Date.now(),u();try{const e=Math.max(0,1e3*t),s=1e3*r;if(s<0)return void n([],{noData:!0});await c.getData({startTime:e,endTime:s},(({data:e=[]})=>{l(Date.now());const t=document.querySelector(`#${o}`);try{t&&n(e,{noData:!e.length})}catch(e){}}),(e=>{a(e)}))}catch(e){}},getMarks:async(e,t,r,n)=>{n(await c.getMarks())},setDataProvider:function(e){c=e},setTickSize:function(e){i=e},setContainerId:function(e){o=e},onReady:function(e){setTimeout((()=>{e({exchanges:[],symbols_types:[],supported_resolutions:ee.Tz,supports_marks:!0,supports_timescale_marks:!0,supports_time:!0})}),0)},searchSymbols:function(){},resolveSymbol:function(e,t){const r={description:e,fractional:!1,has_intraday:!0,has_daily:!0,has_weekly_and_monthly:!0,minmov:1,minmove2:0,name:e,ticker:e,timezone:"Etc/UTC",pricescale:10**Math.abs(Math.log10(i)),session:"24x7",type:"crypto",has_seconds:!0,hash_empty_bar:!0};setTimeout((()=>{t&&t(r)}),0)},subscribeBars:async function(e,t,r,o){const s=c.subscribe({symbolInfo:e,resolution:t,uid:o},(e=>{const{time:t,open:n,high:o,low:a,close:s,volume:i}=e;r({time:t,open:n,high:o,low:a,close:s,volume:i})}));a=s,n.set(o,s)},unsubscribeBars:function(e){n.get(e)?.()},getServerTime:async function(e){try{const{serverTime:t}=await(async e=>await(async(e,t)=>await(0,Me.U2)(`/${e?"dapi":"fapi"}/v1/time`,{enableErrorMsgIntercept:!1}))(!e))(r);e(Math.floor(parseInt(`${t}`,10)/1e3))}catch(t){e(Date.now())}},unsubscribe:function(){a?.()}}})(m,{tickSize:s,isFutures:!0})),[]);return(0,o.useEffect)((()=>{p.setDataProvider(m)}),[m]),(0,o.useEffect)((()=>{p.setTickSize(d)}),[d,p]),p},Lt="https://benchmarks.pyth.network/v1/shims/tradingview";var Mt=r(22645),Bt=r(59712);const At=new Map,$t=({symbol:e,TICK_SIZE:t,chartRef:r})=>{const n=xt({symbol:e,chartRef:r}),a=Ce()[e],{tickSize:s=t}=a||{},i=(0,o.useMemo)((()=>(({tickSize:e,getMarks:t})=>{let r=e;return{onReady:async e=>{const t={...await(async()=>{const e=await fetch(`${Lt}/config`);return await e.json()})(),supported_resolutions:ee.Tz,supports_marks:!0,supports_timescale_marks:!0,supports_time:!0};(0,Mt._M)(),setTimeout((()=>e(t)))},searchSymbols:()=>{},resolveSymbol:async(e,t,n)=>{Bt.log("[resolveSymbol]: Method call",e);try{const n=await(async e=>{const t=await fetch(`${Lt}/symbols?symbol=${e}`);return await t.json()})(e);Bt.log("[resolveSymbol]: Symbol resolved",n),t({...n,has_seconds:!0,supported_resolutions:ee.Tz,pricescale:10**Math.abs(Math.log10(r))})}catch(t){Bt.log("[resolveSymbol]: Cannot resolve symbol",e),n("Cannot resolve symbol")}},getBars:async(e,t,r,n,o)=>{const{from:a,to:s,firstDataRequest:i}=r;Bt.log("[getBars]: Method call",e,t,a,s);try{let o=[];if(o="1S"===t?await(async({symbol:e,from:t,to:r})=>{const n=(await(0,Me.U2)(`/bapi/futures/v1/public/future/apx/V2MarkPriceKline?symbol=${e}&startTime=${1e3*t}&endTime=${1e3*r}&limit=1000`)).data??[];if(0===n.length)return[];const o=[];return n.forEach((e=>{const[t,r,n,a,s]=e.map(Number),i={time:1e3*t,open:r,high:n,low:a,close:s,id:(0,Be.v4)()};o.push(i)})),o})({symbol:e.name,from:r.from,to:1e3*r.to>Date.now()?Date.now()/1e3:r.to}):await(async({ticker:e,from:t,to:r,resolution:n})=>{const o=await fetch(`${Lt}/history?symbol=${e}&from=${t}&to=${r}&resolution=${n}`),a=await o.json();if(0===a.t.length)return[];const s=[];for(let e=0;e<a.t.length;++e)s.push({time:1e3*a.t[e],low:a.l[e],high:a.h[e],open:a.o[e],close:a.c[e],id:(0,Be.v4)()});return s})({ticker:e.ticker,from:r.from,to:r.to,resolution:t}),0===o.length)return void n([],{noData:!0});i&&At.set(e.ticker,{...o[o.length-1]}),n(o,{noData:!1})}catch(e){Bt.log("[getBars]: Get error",e),o(e)}},getMarks:async(e,r,n,o)=>{o(await t())},subscribeBars:(e,t,r,n)=>{Bt.log("[subscribeBars]: Method call with subscriberUID:",n),(0,Mt.Aj)(e.ticker??"",r,n,At.get(e.ticker))},unsubscribeBars:e=>{Bt.log("[unsubscribeBars]: Method call with subscriberUID:",e),(0,Mt.VA)(e)},unsubscribe:()=>{},setTickSize:e=>{r=e}}})({symbol:e,tickSize:s,getMarks:n})),[e,s,n]);return(0,o.useEffect)((()=>{i.setTickSize(s)}),[s,i]),i},Ht=({symbol:e,namespace:t})=>(0,o.useMemo)((()=>({orderLines:[]})),[]),Vt=({symbol:e,namespace:t})=>(0,o.useMemo)((()=>({positionLines:[]})),[]),Nt="trd_chart_tv_load_timeout",zt=()=>{const e=Ue({id:"chartReady"}),t=Ue({id:"getBarsStart",timeout:3}),r=Ue({id:"getBarsEnd",timeout:6}),n=Ue({id:"chartResponsive",timeout:3});Ge.init({step:e._(t)._(r)._(n),eventId:Nt}),Ge({eventId:Nt,stepId:"chartReady",catch({error:e,trackGAEventParams:t}){t({CHART_READY_TYPE:e,connection:JSON.stringify(navigator.connection)})},log({trackGAEventParams:e}){e({CHART_READY_TYPE:"SUCCESS",connection:JSON.stringify(navigator.connection)})}})},Ot=e=>{Ge({eventId:Nt,stepId:"chartResponsive",catch({error:e,trackGAEventParams:t}){t({CHART_RESPONSIVE_TYPE:e,connection:JSON.stringify(navigator.connection)})},log({trackGAEventParams:t}){t({CHART_RESPONSIVE_TYPE:"SUCCESS",duration_:We(Date.now()-e)})}})};function Gt({namespace:e=be.MM}){const t=(0,o.useMemo)((()=>O().createInstance({name:e})),[e]),{symbol:r}=(0,te.Dp)(),a=(0,we.NE)(r),{getI18n:s}=(0,ee.ZK)(),i=(0,te.v5)(e)(ue),c=Te(e),l=_e(e),u=ke(e),d=Ee(e),m=Ie(e),p=xe(e),h=Pe(e),y=Re(e),f=De(e),g=Le(e);return(0,n.jsx)(J,{getI18n:s,useLng:he.tZ,STATIC_HOST:X.brokerConfig.staticBaseUrl,TRADINGVIEW_STATIC_PATH:X.brokerConfig.TRADINGVIEW_STATIC_PATH,namespace:e,storage:t,symbol:r,showLoading:i,electron:fe.Z,trackGAEvent:ge.wu,logOnChartReady:zt,logOnChartResponsive:Ot,useOrderLine:Ht,usePositionLine:Vt,useTheme:ye.F,useThemeScheme:pe.n,useAllProduct:Ce,useCreateDatafeed:a?$t:Dt,useLoadingStore:c,useTvChartStyleStore:l,useIfShowTVIndicatorsMenu:u,useToggleShowTVIndicatorsMenu:d,useIntervalConfigStore:m,useIntervalStore:p,useSelectedIntervalsStore:h,useIsEditingIntervalStore:y,usePriceTypeStore:f,useChartTypeStore:g},a?"pyth":"origin")}}}]);